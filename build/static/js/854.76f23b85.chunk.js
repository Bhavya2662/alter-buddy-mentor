"use strict";(self.webpackChunkalter_buddy=self.webpackChunkalter_buddy||[]).push([[854],{8854:(t,e,s)=>{s.r(e),s.d(e,{HMSEffectsPlugin:()=>n});var i=s(7833),r="https://assets.100ms.live/effectsdk/3.4.3/",n=class{constructor(t,e){this.blurAmount=0,this.background="none",this.backgroundType="none",this.preset="balanced",this.initialised=!1,this.intervalId=null,this.effects=new i.tsvb(t),this.onInit=e,this.effects.config({sdk_url:r,models:{colorcorrector:"",facedetector:"",lowlighter:""},wasmPaths:{"ort-wasm.wasm":"".concat(r,"ort-wasm.wasm"),"ort-wasm-simd.wasm":"".concat(r,"ort-wasm-simd.wasm")}}),this.canvas=document.createElement("canvas"),this.effects.onError(t=>{(!t.type||"error"===t.type)&&console.error("[HMSEffectsPlugin]",t)}),this.effects.cache(),this.effects.onReady=()=>{var t;this.effects&&(this.initialised=!0,null==(t=this.onInit)||t.call(this),this.effects.setBackgroundFitMode("fill"),this.effects.setSegmentationPreset(this.preset))}}getName(){return"HMSEffects"}executeAfterInit(t){this.initialised&&t(),null!==this.intervalId&&clearInterval(this.intervalId),this.intervalId=setInterval(()=>{this.initialised&&(clearInterval(this.intervalId),t())},100)}removeBlur(){this.blurAmount=0,this.executeAfterInit(()=>{this.effects.clearBlur()})}removeBackground(){this.background="",this.executeAfterInit(()=>{this.effects.clearBackground()})}setBlur(t){this.blurAmount=t,this.backgroundType="blur",this.removeBackground(),this.executeAfterInit(()=>{this.effects.setBlur(this.blurAmount),this.effects.run()})}setPreset(t){return((t,e,s)=>new Promise((i,r)=>{var n=t=>{try{h(s.next(t))}catch(e){r(e)}},a=t=>{try{h(s.throw(t))}catch(e){r(e)}},h=t=>t.done?i(t.value):Promise.resolve(t.value).then(n,a);h((s=s.apply(t,e)).next())}))(this,null,function*(){return this.preset=t,new Promise((t,e)=>{this.executeAfterInit(()=>{this.effects.setSegmentationPreset(this.preset).then(t).catch(e)})})})}onResolutionChange(t){this.onResolutionChangeCallback=t}getPreset(){return this.preset}removeEffects(){this.backgroundType="none",this.removeBackground(),this.removeBlur(),this.executeAfterInit(()=>{this.effects.stop()})}setBackground(t){this.background=t,this.backgroundType="image",this.removeBlur(),this.executeAfterInit(()=>{this.effects.setBackground(this.background),this.effects.run()})}getBlurAmount(){return this.blurAmount}getBackground(){return this.background||this.backgroundType}updateCanvas(t){let{height:e,width:s}=t.getVideoTracks()[0].getSettings();this.canvas.width=s,this.canvas.height=e,this.effects.useStream(t),this.effects.toCanvas(this.canvas)}apply(t){return this.effects.clear(),this.applyEffect(),this.effects.onChangeInputResolution(()=>{var e;this.updateCanvas(t);let{height:s,width:i}=t.getVideoTracks()[0].getSettings();null==(e=this.onResolutionChangeCallback)||e.call(this,i,s)}),this.updateCanvas(t),this.canvas.captureStream(30)||t}stop(){this.removeEffects()}applyEffect(){this.blurAmount?this.setBlur(this.blurAmount):this.background&&this.setBackground(this.background)}}}}]);